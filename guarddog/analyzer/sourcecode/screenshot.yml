rules:
  - id: screenshot
    languages:
      - python
    message: This package is taking screenshots, which can be used to steal sensitive information displayed on screen
    metadata:
      description: Identify when a package captures screenshots of the user's display
    patterns:
      - pattern-either:
          # PIL ImageGrab
          - pattern: ImageGrab.grab(...)
          - pattern: PIL.ImageGrab.grab(...)

          # pyscreenshot library
          - pattern: pyscreenshot.grab(...)

          # pyautogui library
          - pattern: pyautogui.screenshot(...)

          # mss library - various patterns
          - pattern: mss.mss().grab(...)
          - pattern: |
              with mss.mss() as $SCT:
                  ...
                  $SCT.grab(...)
          - pattern: |
              $SCT = mss.mss()
              ...
              $SCT.grab(...)
          - pattern: $MSS.grab(...)

          # D3DShot (Windows DirectX screenshots)
          - pattern: d3dshot.create(...).screenshot(...)
          - pattern: |
              $D3D = d3dshot.create(...)
              ...
              $D3D.screenshot(...)
    severity: WARNING
