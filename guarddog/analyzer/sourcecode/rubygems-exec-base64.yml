rules:
  - id: rubygems-exec-base64
    languages:
      - ruby
    message: |
      This package contains a call to eval with base64-decoded content.
      This is a common method to hide malicious payloads from static analysis.
    metadata:
      description: Identify when a package dynamically executes base64-encoded code
    mode: taint
    pattern-sources:
      - pattern-either:
          - pattern: Base64.decode64(...)
          - pattern: Base64.strict_decode64(...)
          - pattern: Base64.urlsafe_decode64(...)
          - pattern: $X.unpack("m")
          - pattern: $X.unpack("m0")
    pattern-sinks:
      - pattern-either:
          - pattern: eval(...)
          - pattern: instance_eval(...)
          - pattern: class_eval(...)
          - pattern: module_eval(...)
          - pattern: Kernel.eval(...)
          - pattern: binding.eval(...)
    severity: WARNING
