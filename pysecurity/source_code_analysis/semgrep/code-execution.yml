rules:
  - id: code-execution
    languages:
      - python
    message: Code execution found in setup.py, could potentially execute unwanted code.
    pattern-either:
      # Hardcoded string in exec function
      - pattern: exec("...", ...)
      - pattern: exec("...". ...)
      - pattern: exec("..." + ...)
      - pattern: execfile(...)
      - patterns:
        - pattern: eval($ARG1. ...)
        - pattern-not-inside: |
            if $ARG1.startswith($STR):
              ...
      - pattern: (...).getoutput(...)
      - pattern: (...).call(...)
      - patterns:
        - pattern-either:
          - pattern: (...).Popen($ARG1, ...)
          - pattern: (...).popen($ARG1, ...)
          - pattern: Popen($ARG1, ...)
          - pattern: popen($ARG1, ...)
        - metavariable-pattern:
            metavariable: $ARG1
            patterns:
              - pattern-not: (["git"] + ...)
    paths:
      include:
        - "*/setup.py"
        - semgrep_tests/code-execution.py # Need to run on test file
    severity: WARNING


# - metavariable-pattern:
#     metavariable: $VERSION
#     patterns:
#       - pattern-not-regex: (.*/?[__]?version.py[__]?)



